<style>
    .running-dashboard {
        margin: 2rem 0;
    }
    .run-hero {
        background: var(--entry);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 20px;
        display: grid;
        gap: 12px;
    }
    .run-hero-header {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
    }
    .run-hero-title {
        font-size: 1.2rem;
        font-weight: 800;
        color: var(--primary);
    }
    .run-hero-subtitle {
        font-size: 0.85rem;
        color: var(--secondary);
    }
    .run-hero-name {
        font-size: 1.4rem;
        font-weight: 800;
        color: var(--primary);
    }
    .run-hero-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 12px;
    }
    .run-stat {
        background: var(--theme);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 12px;
        text-align: center;
    }
    .run-stat-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: var(--secondary);
        letter-spacing: 0.08em;
    }
    .run-stat-value {
        font-size: 1.4rem;
        font-weight: 800;
        margin-top: 6px;
        color: var(--primary);
    }
    .run-error {
        color: #d6453d;
        font-size: 0.9rem;
    }
</style>

{{ $data := .Site.Data.strava.latest }}
{{ if not $data }}
<div class="running-dashboard">
    <div class="run-hero">
        <div class="run-hero-header">
            <div class="run-hero-title">Latest Run</div>
            <div class="run-hero-subtitle">No data yet</div>
        </div>
        <div class="run-hero-name">Waiting on your weekly update…</div>
        <div class="run-error">Add data at data/strava/latest.json or run the GitHub Action.</div>
    </div>
</div>
{{ else }}
{{ $distanceM := float $data.distance_m }}
{{ $miles := div $distanceM 1609.344 }}
{{ $moving := int $data.moving_time_s }}
{{ $elev := int $data.total_elevation_gain_m }}

{{ $paceTotal := 0 }}
{{ if gt $miles 0.0 }}
    {{ $paceSec := div (float $moving) $miles }}
    {{ $paceTotal = int (math.Round $paceSec) }}
{{ end }}
{{ $paceMin := div $paceTotal 60 }}
{{ $paceSecs := mod $paceTotal 60 }}

{{ $hours := div $moving 3600 }}
{{ $minutes := div (mod $moving 3600) 60 }}
{{ $seconds := mod $moving 60 }}

{{ $timeStr := printf "%d:%02d" $minutes $seconds }}
{{ if gt $hours 0 }}
    {{ $timeStr = printf "%d:%02d:%02d" $hours $minutes $seconds }}
{{ end }}

{{ $paceStr := "—" }}
{{ if gt $miles 0.0 }}
    {{ $paceStr = printf "%d:%02d /mi" $paceMin $paceSecs }}
{{ end }}

{{ $dateStr := "" }}
{{ if $data.start_date_local }}
    {{ $dateStr = (time $data.start_date_local) | time.Format "Jan 2, 2006" }}
{{ end }}

<div class="running-dashboard">
    <div class="run-hero">
        <div class="run-hero-header">
            <div class="run-hero-title">Latest Run</div>
            <div class="run-hero-subtitle">{{ $dateStr }}</div>
        </div>
        <div class="run-hero-name">{{ $data.name }}</div>
        <div class="run-hero-grid">
            <div class="run-stat">
                <div class="run-stat-label">Distance</div>
                <div class="run-stat-value">{{ printf "%.2f mi" $miles }}</div>
            </div>
            <div class="run-stat">
                <div class="run-stat-label">Time</div>
                <div class="run-stat-value">{{ $timeStr }}</div>
            </div>
            <div class="run-stat">
                <div class="run-stat-label">Pace</div>
                <div class="run-stat-value">{{ $paceStr }}</div>
            </div>
            <div class="run-stat">
                <div class="run-stat-label">Elevation</div>
                <div class="run-stat-value">{{ printf "%d m" $elev }}</div>
            </div>
        </div>
    </div>
</div>
{{ end }}
